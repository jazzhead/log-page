Log Page --- GUI Testing for AppleScript Dialogs
================================================

The test scripts in this directory (the AppleScript files whose names begin
with four digits) launch the target script (`log_page.applescript` in the [Log
Page][website] project root directory) for testing and then test that script's
user interface by selecting menu items and clicking buttons in the target
script's modal dialogs. Files generated by the target script are also checked.

The length of time that the dialogs are displayed before being dismissed can be
configured by passing command-line arguments to `osascript` when using
`osascript` to launch the test script. Additionally, arguments for the target
script can be passed along to that script for changing its configuration.  See
the target script for its available settings. See the `parse_args()` function
in `t/lib/log_page_test.applescript` for details of the argument format, but
basically it's `key:value` except the leading and trailing underscores from the
AppleScript script property need to be stripped off. So to set the
`__TEST_DELAY__` script property to 3 seconds, the command-line arg would be
`TEST_DELAY:3`.

All test script names start with four digits and a hyphen. Those scripts are
essentially wrapper scripts that act as controllers. The actual tests are in a
directory named for the four digits of the wrapper script name. Each of those
files are named with exactly two digits (plus the `.applescript` file
extension)

To run directly from the command-line (from the project root directory):

    $ osascript t/TEST_NAME.applescript

    # Arguments can also be passed to the test script:
    $ osascript t/TEST_NAME.applescript TEST_DELAY:3 INFO_DELAY:10

To run through the `prove` TAP harness from the command-line:

    # Doesn't work, maybe because of osascript buffering issues
    #$ prove [-fv] -e '/usr/bin/osascript' t/TEST_NAME.applescript

    # Need to instead create a shell script wrapper that disables
    # output buffering:
    #
    #   #!/bin/sh
    #   script -q /dev/null /usr/bin/osascript t/TEST_NAME.applescript "$@"
    #   exit
    #
    # and then run that wrapper with prove:
    $ prove [-fv] t/TEST_NAME.sh
    #
    # or with arguments (the `::` separates them from prove's own args)
    $ prove [-fv] t/TEST_NAME.sh :: TEST_DELAY:3 INFO_DELAY:10

To run all tests in the test directory with 'prove':

    $ prove [-fv] t/[0-9][0-9][0-9][0-9]-*.sh
    # or with arguments:
    $ prove [-fv] t/[0-9][0-9][0-9][0-9]-*.sh :: TEST_DELAY:3 SKIP_INFO:true

There are also Makefile targets for running all of the tests. `make test` runs
`prove -fv` while `make test-quiet` runs `prove -f`.

File listing showing a hypothetical "0001" test suite and all supporting files
(the actual "0001" test suite doesn't have every supporting file shown):

    .                                     # project root directory
    |-- t                                 # test directory
    |   |-- 0001                          # a test suite directory
    |   |   |-- 01.applescript            # a test group (the actual tests)
    |   |   `-- 02.applescript            # a test group (the actual tests)
    |   |-- 0001-first.applescript        # a test suite controller/wrapper
    |   |-- 0001-first.sh -> template.sh  # shell script wrapper symlink
    |   |-- data                          # data files used by tests
    |   |   |-- expected                  # expected results for tests
    |   |   |   |-- 0001-urls.txt         # expected bookmarks file
    |   |   |   `-- 0001.plist            # expected plist file
    |   |   |-- initial                   # preconfigured files for tests
    |   |   |   `-- 0001-urls.txt         # bookmarks file to use for tests
    |   |   `-- sample.html               # HTML file used by all tests
    |   |-- lib
    |   |   |-- log_page_test.applescript # custom test superclass
    |   |   |-- tap.applescript           # TAP library
    |   |   |-- test_data.applescript     # data testing lib (extends TAP)
    |   |   |-- test_gui.applescript      # gui testing lib (extends TAP)
    |   |   `-- util.applescript          # shared utility functions
    |   `-- template.sh                   # actual shell script wrapper
    `-- log_page.applescript              # target script being tested

As mentioned above, all test suites should follow the same naming format --- a
four-digit identifier used for:

-   The first four characters of an AppleScript controller/wrapper script.
-   The first four characters of the shell script wrapper for that AppleScript.
-   The name of a test suite directory where the actual test files for that
    suite are stored.
-   The first four characters of any supporting files in the `t/data`
    directory.
-   The first four characters of any files written to the `t/tmp` directory.

  [website]: http://jazzheaddesign.com/work/code/log-page/
